<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<title>companion</title>
	<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.7.1.min.js"></script>
	<script type="text/javascript">
	$(function(){
		// 페이지가 열릴 때 상품정보가 출력되게 함수를 실행 시켜줍니다.
		goodsDescript();

		$("#buyItem").click(function(){
			location.href="../buyItem?goodsNum=[[${dto.goodsDTO.goodsNum}]]&qty="+$("#qty").val();
		});

		$("#qty").click(function(){
			const money = [[${dto.goodsDTO.goodsPrice}]] * $("#qty").val();
			const moneyFormatter = new Intl.NumberFormat('ko-KR',{style:'currency',currency:'KRW'});
			const formattedMoney = moneyFormatter.format(money);
			$("#tot").text(formattedMoney + '원');
		});

		$("#cartBtn").click(function(){
			if([[${session.auth == null}]]){
				window.open("/login/item.login","login","width=315, height=200,top = 100, left=100");
			}else{
				$.ajax({
					type:"get",
					url:"../cartAdd",
					dataType:"text",
					data:{"goodsNum" : "[[${dto.goodsDTO.goodsNum}]]","qty":$("#qty").val()},
					success:function(result){
						if(result.trim() == "200"){
							if(confirm("계속 쇼핑하려면 '취소'를 클릭하세요.")){
								location.href="../cartList";
							}else if(result.trim() == "999"){
								alert("관리자는 사용할 수 없는 페이지입니다.");
							}else if(result.trim() == "000"){
								alert("로그인을 해야합니다.");
							}
						}
					},
					error:function(){
						alert("관리자는 사용할 수 없는 페이지입니다.");
					}
				});
			}
		});

        $("#wish").click(function(){
            if([[${session.auth == null}]]){
                window.open("/login/item.login","login","width=315, height=200,top = 100, left=100");
            }else{
                $.ajax({
                    type:"post",
                    url:"../goodsWishAdd",
                    dataType:"text",
                    data:{"goodsNum" : "[[${dto.goodsDTO.goodsNum}]]"},
                    success:function(result){
                        if(result.trim() == "1"){
                            $("#wish").attr("src","/static/images/heart.png");
                        }else if(result.trim() == "0"){
                            $("#wish").attr("src","/static/images/heart1.png");
                        }else if(result.trim() == "999"){
                            alert("관리자는 사용할 수 없습니다.");
                        }
                    },
                    error:function(){
                        alert("관리자는 사용할 수 없습니다.");
                    }
				});
			}
		});

		//삼품정보를 클릭하면 상품정보 함수가 실행되게 합니다.
		$("#descript").click(function(){
			goodsDescript();
		});

		// 리뷰를 클릭하면 리뷰정보를 받올 수 있게 합니다.
		$("#review").click(function(){
			$.ajax({
				type : "post" ,
				url : "/review/reviewList",
				dataType : "html",
				data : {"goodsNum" : "[[${dto.goodsDTO.goodsNum}]]"},
				success : function(result){
					$("#notice").html(result);
					},
				error : function(){
					alert("서버오류!!!!");
					return false;
				}
			});
		});

		$("#inquire").click(function(){
			inquire();
		});

	});
	//메인페이지들어왔다가 다시 들어오면 관심상품이 등록되어 있어도 표시가 안된다.
	//구매페이지들어올때 관심상품이 있는 회원인지 확인을 해야 한다.
	// 현재 우리는 회원만 등록 가능하고 직원은 등록할 수 없다. 직원인 경우 코드를 추가해준다.


	// 삼품정보를 가지고 올 함수를 정의합니다.
	function goodsDescript(){
		$.ajax({
			type : "post" ,
			url : "../goodsDescript",
			dataType : "html",
			data : {"goodsNum" : "[[${dto.goodsDTO.goodsNum}]]"},
			success : function(result){ //result를 html로 받아와서 출력하겠습니다.
				$("#notice").html(result);
				},
			error : function(){
				alert("서버오류!!!!");
				return false;
			}
		});
	}

	// 상품문의 를 불러올 함수를 만들겠습니다.
	function inquire(){ // 상품정보 , 리뷰, 상품문의가 모두 코드가 같습니다. 데이터를 불러올 주소만 다릅니다.
		$.ajax({
			type : "post" ,
			url : "/inquire/inquireList",
			dataType : "html",
			data : {"goodsNum" : "[[${dto.goodsDTO.goodsNum}]]"},
			success : function(result){ //result를 html로 받아와서 출력하겠습니다.
				$("#notice").html(result);
			},
			error : function(){
				alert("서버오류!!!!");
				return false;
			}
		});
	}
	</script>
</head>
<body>
	<table width="800" align="center">
		<tr><td colspan="2">([[${dto.goodsDTO.goodsName}]]) 상품정보 입니다. | 상품 조회수 : [[${dto.goodsDTO.visitCount}]]</td></tr>
		<tr><td rowspan="6" width="300px">
			<img th:src="|/static/upload/${dto.goodsDTO.goodsMainStore}|" alt="상품이미지"/></td>
			<td>상품명 : [[${dto.goodsDTO.goodsName}]]</td>
		</tr>
		<tr><td>카테고리 : [[${dto.goodsDTO.goodsCategory}]]</td></tr>
		<tr><td>가격 : [[${#numbers.formatCurrency(dto.goodsDTO.goodsPrice)+'원'}]]</td></tr>
		<tr><td>배송비 <span th:if="${dto.goodsDTO.deliveryCost == 0}">무료배송</span>
			<span th:if="${dto.goodsDTO.deliveryCost != 0}">
						[[${#numbers.formatCurrency(dto.goodsDTO.deliveryCost) + '원'}]]</span>
		</td></tr>
		<tr><td>수량 : <input type="number" min=1 step="1" value="1" id="qty" name="qty" /></td></tr>
		<tr><td>총 상품금액 : <span id="tot">[[${#numbers.formatCurrency(dto.goodsDTO.goodsPrice) + '원'}]]</span></td></tr>
		<tr><td><!--  재고가 있을 때만 버튼이 보이게  -->
			<button type="button" id="cartBtn" th:if="${dto.stock > 0 }"> 장바구니 |</button>
			<button type="button" id="buyItem" th:if="${dto.stock > 0 }"> 바로구매  |</button>
			<span th:if="${dto.stock <= 0 }" >  입고 예정 상품입니다  </span>
			<th:block th:if="${wish == null}">
				<img src="/static/images/heart1.png" id="wish" width="20" />
			</th:block>
			<th:block th:if="${wish != null}">
				<img src="/static/images/heart.png" id="wish" width="20" />
			</th:block> 찜
		</td>
		</tr>
		<tr><td colspan="2">남은 수량 :[[${dto.stock}]] 개</td></tr>
		<tr><td colspan="2">
			<p>
			<span id="descript">제품 상세 설명</span> |
			<span id="review">리뷰</span> |
			<span id="inquire" >상품문의</span>
			</p>
			<!--  제품 상세 설명를 클릭하면 제품정보가, 리뷰를 클릭하면 리뷰정보가, 상품문의를 클릭하면 상품문의가 나오게 해봅니다.-->
			<!-- 먼저 상품정보 부터 가져오겠습니다. -->
			<div id="notice"></div>
		</td></tr>
	</table>
</body>
</html>